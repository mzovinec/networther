<div class="dashboard-container">
  <div class="dashboard-filters" style="margin-bottom: 1rem">
    <label style="cursor: pointer">
      <input
        type="checkbox"
        [checked]="showCurrentYearOnly()"
        (change)="toggleCurrentYearOnly()"
      />
      Show current year only
    </label>
  </div>
  <div class="summary-cards">
    <div class="card purchase-value">
      <h2>
        @if (selectedCategory()) {
        {{ selectedCategory() }} Original Value } @else { Total Original Value }
      </h2>
      <p class="value">
        {{ totalPurchaseValue() | currency : "CZK" : "" : "1.0-0" }} CZK
      </p>
    </div>
    <div class="card net-worth">
      <h2>
        @if (selectedCategory()) {
        {{ selectedCategory() }} Current Value } @else { Total Current Value }
      </h2>
      <p class="value">
        {{ netWorth() | currency : "CZK" : "" : "1.0-0" }} CZK
      </p>
      <div class="percentage-container">
        <p class="percentage-indicator">
          <span class="label"
            >{{
              100 - depreciationPercentageFromOriginal() | number : "1.1-1"
            }}% of original value</span
          >
        </p>
      </div>
    </div>
    <div class="card depreciation">
      <h2>
        @if (selectedCategory()) {
        {{ selectedCategory() }} Depreciation } @else { Total Depreciation }
      </h2>
      <p class="value">
        {{ depreciation() | currency : "CZK" : "" : "1.0-0" }} CZK
      </p>
      <div class="depreciation-percentages">
        <p class="percentage-indicator">
          <span class="label"
            >- {{ depreciationPercentageFromCurrent() | number : "1.1-1" }}%
            depreciation</span
          >
        </p>
      </div>
    </div>
    <div class="card item-count">
      <h2>
        @if (selectedCategory()) {
        {{ selectedCategory() }} Items } @else { Total Items }
      </h2>
      <p class="value">{{ filteredItemCount() }}</p>
    </div>
  </div>

  <div class="dashboard-content">
    @if (currentView() === 'dashboard') {
    <div class="section">
      <div class="section-header">
        <a [routerLink]="['/items']" class="view-all">View All</a>
      </div>

      <div class="top-items">
        @if (topItems().length === 0) {
        <p class="empty-state">
          No items added yet. Add some items to see them here.
        </p>
        } @else {
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Category</th>
              <th>Current Value (CZK)</th>
            </tr>
          </thead>
          <tbody>
            @for (item of topItems(); track item.id) {
            <tr>
              <td>{{ item.name }}</td>
              <td>{{ item.category }}</td>
              <td>{{ item.currentValue | currency : "CZK" : "" : "1.0-0" }}</td>
            </tr>
            }
          </tbody>
        </table>
        }
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <h2>Categories Breakdown</h2>
      </div>

      <div class="category-summary">
        @if (categorySummary().length === 0) {
        <p class="empty-state">
          No items added yet. Add some items to see category breakdown.
        </p>
        } @else {
        <div class="categories-grid">
          @for (category of categorySummary(); track category.category) {
          <div
            class="category-card"
            [class.active]="selectedCategory() === category.category"
            (click)="selectCategory(category.category)"
          >
            <h3>{{ category.category }}</h3>
            <p class="count">{{ category.count }} item(s)</p>
            <p class="value">
              {{ category.totalValue | currency : "CZK" : "" : "1.0-0" }} CZK
            </p>
            <p class="percentage">
              @if (selectedCategory()) { @if (selectedCategory() ===
              category.category) {
              {{ category.percentage }}% (selected) } @else {
              {{ category.percentage }}% relative to {{ selectedCategory() }}
              } } @else {
              {{ category.percentage }}% of total }
            </p>
            <div class="click-hint">Click to filter items</div>
          </div>
          }
        </div>
        }
      </div>
    </div>
    } @if (currentView() === 'yearly') {
    <div class="section yearly-section">
      <div class="section-header">
        <h2>Yearly Breakdown</h2>
      </div>

      @if (yearlyBreakdown().length === 0) {
      <p class="empty-state">
        No items added yet. Add some items to see yearly breakdown.
      </p>
      } @else {
      <div class="yearly-table">
        <table>
          <thead>
            <tr>
              <th>Year</th>
              <th>Items</th>
              <th>Purchase Value (CZK)</th>
              <th>Current Value (CZK)</th>
              <th>Depreciation (CZK)</th>
              <th>Depreciation %</th>
              <th>Retention %</th>
            </tr>
          </thead>
          <tbody>
            @for (yearData of yearlyBreakdown(); track yearData.year) {
            <tr>
              <td>
                <strong>{{ yearData.year }}</strong>
              </td>
              <td>{{ yearData.itemCount }}</td>
              <td>
                {{ yearData.purchaseValue | currency : "CZK" : "" : "1.0-0" }}
              </td>
              <td>
                {{ yearData.currentValue | currency : "CZK" : "" : "1.0-0" }}
              </td>
              <td>
                {{ yearData.depreciation | currency : "CZK" : "" : "1.0-0" }}
              </td>
              <td>
                <span class="percentage-badge negative">
                  -{{
                    getDepreciationPercentage(
                      yearData.purchaseValue,
                      yearData.depreciation
                    ) | number : "1.1-1"
                  }}%
                </span>
              </td>
              <td>
                <span class="percentage-badge positive">
                  {{
                    getRetentionPercentage(
                      yearData.purchaseValue,
                      yearData.currentValue
                    ) | number : "1.1-1"
                  }}%
                </span>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }
    </div>
    }
  </div>

  <div class="actions">
    <a [routerLink]="['/add-item']" class="add-item-btn">Add New Item</a>
    @if (currentView() === 'dashboard') {
    <button class="view-switch-btn" (click)="switchView('yearly')">
      View Yearly Breakdown
    </button>
    } @else {
    <button class="view-switch-btn" (click)="switchView('dashboard')">
      Back to Dashboard
    </button>
    }
  </div>
</div>
